---
title: Configuration de mon poste de travail  
description: Le mat√©riel/OS que j'utilise, l'environnement, les fichiers de configuration et des astuces de workflow.  
categories: [Linux]  
tags: [linux, config, dotfile, arch, hyprland]  
sidebar:  
  order: 100  
  badge:  
    text: conf  
    variant: tip  
---

import { Steps, Icon } from '@astrojs/starlight/components';

## PC portable

Avant de nommer le mod√®le, je voudrais d'abord dire que j'ai fix√© quelques limites concernant le budget et les performances de la machine. J'ai besoin d'un ordinateur portable pour l'**√©cole et les √©v√©nements** et je veux qu'il soit aussi **puissant que possible** (j'ai pens√© √† un i7 ou Ryzen 7 et 16 Go, ce qui semble bien pour quelques machines virtuelles et du pentesting) pour un budget autour de **600 $** (550 ‚Ç¨). J'ai donc cherch√© un **ordinateur d'occasion** sur des places de march√© connues afin d'obtenir un bon rapport qualit√©/prix. Id√©alement, je souhaiterais un **capteur d'empreintes digitales**, une **"cache cam√©ra"** incluse et un **ordinateur l√©ger** (pour les d√©placements).

En tant que professionnel de l'informatique depuis quelques ann√©es, j'ai remarqu√© que de nombreuses entreprises (y compris celles o√π j'ai travaill√©) **sont pass√©es de diverses marques aux Lenovo Thinkpads** pour de bonnes raisons telles que le design, le ressenti, le rapport performance/prix, le clavier, les fonctionnalit√©s et surtout la stabilit√© et le bon support. J'ai eu beaucoup de Thinkpads entre les mains et je les trouve excellents. J'en prendrai donc un pour moi.

Le contexte √©tant pos√©, apr√®s quelques semaines de recherche, j'en ai trouv√© un qui r√©pond parfaitement √† mes besoins en parfait √©tat pour 550 $. Le stockage √©tait d'environ **500 Go**, donc j'ai command√© un nouveau SSD nvme de **1 To** en m√™me temps pour 100 $ et j'ai augment√© la m√©moire flash √† 32 Go pour 60 $.

Voici le mod√®le pr√©cis que j'ai maintenant : **Lenovo ThinkPad P14s Gen 1 - 14"**

Avant | Arri√®re
--- | ---
![Sources des images : OfficeXpress](../../../assets/linux/my-configuration/laptop.webp) | ![Sans aucun autocollant üòâ](../../../assets/linux/my-configuration/laptopb.webp)

CPU | RAM | ROM
--- | --- | ---
Ryzen 7 PRO 4750U (8 c≈ìurs physiques) | 32 Go 3200Mhz | 1 To Nvme Samsung EVO 775 Pro

Toutes les sp√©cifications peuvent √™tre trouv√©es [ici](https://www.officexpress.fr/10145925-20y1000qfr-lenovo-thinkpad-p14s-gen-20y1-amd-ryzen-pro-4750u-jusqu-ghz-win-pro-bits-radeon-graphics-ram-256-ssd-tcg-opal-encryption-ips-1920-1080-full-noir-clavier-fran-ais-3540260184357).

**PS** : J'ai pens√© aux Thinkpads avec **IntelME** __partiellement__ d√©sactiv√© et **libreboot** üïµÔ∏è, mais minifree.org ne propose pas de machines r√©centes, j'√©tais int√©ress√© par le T440p qu'ils ont (litt√©ralement une brique) et il y a un √©cart significatif entre l'i7 4√®me gen et le Ryzen 7 4√®me gen du P14S Gen1.

## Syst√®me d'exploitation

![](../../../assets/linux/my-configuration/iusearchbtw.webp)

Si vous souhaitez prendre soin des paquets, des configurations et des scripts vous-m√™me, Arch est la voie √† suivre pour garder le contr√¥le et surtout **APPRENDRE** en faisant et comprendre le fonctionnement des paquets et du GNU/Linux. L'OS est vraiment minimal par d√©faut, donc **"FAITES-LE VOUS-M√äME"**.

ArchLinux est une distribution en **"Rolling release"**, ce qui signifie que les paquets sont mis √† jour vers la derni√®re version disponible d√®s qu'elle est pr√™te, donc il n'y a pas de "versions". Il y a aussi le "Arch Wiki", que vous pouvez comparer √† la "Sainte Bible" des utilisateurs d'Arch (et oui, c'est plut√¥t √âNORME). L'**"utilisateur Arch"** est **LE** gars intelligent (c'est ce que disent les utilisateurs, pas moi üòÄ, beaucoup d'humour).

L'**"Arch Users Repository"** est un √©norme d√©p√¥t de paquets fournis par la communaut√©, il vise √† compl√©ter les paquets officiels et permet √† tous les d√©veloppeurs de partager leurs paquets. Gardez √† l'esprit que ces paquets sont non officiels.

---

## Environnement de bureau

![](../../../assets/linux/my-configuration/desktop.webp)

J'aime les choses simples et modernes. J'ai d√©couvert **Hyprland** il y a quelques ann√©es et j'ai d√©cid√© de l'essayer sur cet ordinateur portable, j'ai donc cherch√© des tutoriels sur YouTube pour voir comment les gens l'installaient et le personnalisait. Je suis tomb√© sur la cha√Æne [YouTube de Ja Kool.it](https://www.youtube.com/@Ja.KooLit) et j'ai suivi la vid√©o "My Hyprland Dots v2 on Debian 13 Linux minimal using netinstaller and Debian-Hyprland install script" [vid√©o](https://www.youtube.com/watch?v=Qc4VP9JFh2Y). Cette config **m'a √©poustoufl√©**, elle a fonctionn√© imm√©diatement, elle √©tait rapide, r√©active et agr√©able √† l'≈ìil !

Mais attendez, vous avez dit que vous √©tiez sur Arch maintenant ! Alors oui, j'ai chang√© quelques semaines plus tard en raison de **l'insoutenabilit√© de la version SID de Debian**, du fait que certains **paquets de base ne sont pas maintenus** et que Ja voulait **arr√™ter le support de ses configurations sur Debian Trixie** pour le moment.

**EDIT**: Je suis pass√© aux [dotfiles de ML4W](https://github.com/mylinuxforwork/dotfiles), plus √† jour, avec une interface graphique pour modifier les param√®tres de Hyprland et une meilleure int√©gration.

## Outillage

Quand vous voulez un **environnement de pentesting**, vous penserez d'abord √† une distribution GNU/Linux "Hacking" comme : Kali, Parrot, BlackArch ou AthenaOS. Le gros inconv√©nient de ces distributions est que vous **n'avez pas le contr√¥le sur les paquets install√©s, l'impl√©mentation des projets python** (sont-ils correctement install√©s dans des venv, avec des liens symboliques pour plus de commodit√© ?), **les bloatwares** (les paquets install√©s par d√©faut que vous n'utiliserez jamais et oui, il y en a beaucoup !), oh, et oui encore **les d√©pendances python qui peuvent entrer en conflit avec le temps**. Pour conclure, s√©parer le syst√®me d'exploitation des outils utilis√©s est la voie √† suivre.

C'est ici que **Exegol** entre en jeu. Pour ceux qui ne connaissent pas Exegol, c'est un projet FOSS fran√ßais cr√©√© par Shutdown, Dramelac avec le soutien de Capgemini (une grande entreprise technologique) et Hack The Box principalement. L'objectif est de **garder l'OS propre en g√©rant des conteneurs avec un backend docker**. Un wrapper python s'occupe de toutes les "choses docker" pour vous. Ainsi, dans un conteneur, vous avez : **tous les outils dont vous avez besoin**, vous pouvez y attacher un **VPN** (--vpn config.ovpn), ouvrir un navigateur et des applications avec une interface graphique, attacher des **p√©riph√©riques USB**, **bureau √† distance dans l'environnement du conteneur** (en b√™ta, avec --desktop) et plus encore (pour toutes les fonctionnalit√©s, consultez [la documentation d'Exegol](https://exegol.readthedocs.io/en/latest/)).

Le tout est rendu aussi simple que de d√©marrer un conteneur :

```sh
exegol start test nightly
``

![](../../../assets/linux/my-configuration/exegolstart.webp)

O√π `test` est le nom du conteneur et `nightly` est l'image Docker sur laquelle il est bas√©. Vous pouvez t√©l√©charger les images Exegol facilement avec :

```sh
exegol install
```

Il vous demandera le nom de l'image que vous souhaitez installer, comme indiqu√© dans le tableau.

![](../../../assets/linux/my-configuration/exegolinstall.webp)

Les tests suivants sont effectu√©s dans un conteneur bas√© sur l'image nightly :

Consommation en veille | Rustscan avec le param√®tre -- -A
:---: | :---:
![](../../../assets/linux/my-configuration/dockerstatsidle.webp) | ![](../../../assets/linux/my-configuration/dockerstatsrustscan.webp)

Vous pouvez suivre les √©tapes d'installation et obtenir des conseils ici :  

[Exegol Cheat Sheet](offensive/Exegol_Cheat_Sheet.mdx)

## Avis Important

**Remarque** : Lors de l'installation d'Arch, j'ai rencontr√© un probl√®me concernant la disposition du clavier dans l'invite de cryptsetup (qui √©tait r√©gl√©e sur US). Il semble que ce soit un vieux probl√®me pour de nombreux utilisateurs d'Arch. Voici la solution (en chroot apr√®s l'installation ou entrez votre mot de passe en pensant √† la disposition QWERTY) :

<Steps>

1. Editer le fichier vconsole.conf:

   ```sh
   vim /etc/vconsole.conf
   ```

2. D√©finir le mappage du clavier en Fran√ßais:

   ```sh
   KEYMAP=fr-latin9
   ```

3. Puis reconstruire l'image (n√©cessite les privil√®ges root):

   ```sh
   mkinitcpio -P
   ```

</Steps>

## Correction de la webcam

La webcam int√©gr√©e ne fonctionnait pas, j'ai d√ª installer le firmware manquant:

```sh
yay -S upd72020x-fw 
```

### IDE

J'utilise vscode et `nvchad` (bas√© sur neovim) pour naviguer et √©diter facilement des fichiers dans les r√©pertoires:

```sh
nvim
```

![nvchad](../../../assets/linux/my-configuration/nvchad.webp)

## Virtualisation

J'utilise QEMU/KVM et un script pour lancer et acc√©der en RDP automatiquement √† une machine virtuelle d√©di√©e √† la criminalistique.

<Steps>

1. **Installation de QEMU :** Assurez-vous de mettre √† jour votre syst√®me avec un `sudo pacman -Syu` AVANT d'installer les d√©pendances:

   ```sh
   sudo pacman -S qemu virt-manager virt-viewer dnsmasq vde2 bridge-utils openbsd-netcat ebtables iptables libguestfs
   ```

2. Modifiez le fichier /etc/libvirt/libvirtd.conf (Changez les lignes suivantes):

   ```sh
   unix_sock_group = "libvirt"
   unix_sock_rw_perms = "0770"
   ```

3. Ajoutez ensuite votre utilisateur:

   ```sh
   sudo usermod -a -G libvirt $(whoami)
   ```

4. Et cr√©ez un groupe:

   ```sh
   newgrp libvirt
   ```

   Source : [blog de christitus](https://christitus.com/setup-qemu-in-archlinux)

</Steps>

Et le script de **RDP sur une VM**:

```sh
#!/bin/bash

# Merci √† Stephan Raabe pour le script

if [ -f ~/private/win11-credentials.sh ]; then
	echo "Le fichier des identifiants existe. Utilisation du fichier."
	source ~/private/win11-credentials.sh
else
	win11user="USER"
	win11pass="PASS"
	win11ip="IP"
	win11name="windows11"

	echo "## Pr√©paration de l'acc√®s √† distance √† votre machine virtuelle Windows ##"

	echo -n "Veuillez entrer le nom de votre machine virtuelle [par d√©faut : $win11name] : "
	read vmname
	vmname=${vmname:-$win11name}

	echo -n "Veuillez entrer l'IP de votre machine virtuelle [par d√©faut : $win11ip] : "
	read vmip
	vmip=${vmip:-$win11ip}

	echo -n "Veuillez entrer votre nom d'utilisateur [par d√©faut : $win11user] : "
	read user
	user=${user:-$win11user}

	echo -n "Veuillez entrer votre mot de passe [par d√©faut : $win11pass] : "
	read password
	password=${password:-$win11pass}
fi

# echo "Hello, $vmname, $vmip, $user, $password"

tmp=$(virsh --connect qemu:///system list | grep " $vmname " | awk '{ print $3}')

if ([ "x$tmp" == "x" ] || [ "x$tmp" != "xrunning" ]); then
	echo "La machine virtuelle $vmname d√©marre maintenant... Attente de 30s avant de lancer xfreerdp."
	notify-send "La machine virtuelle $vmname d√©marre maintenant..." "Attente de 30s avant de lancer xfreerdp."
	virsh --connect qemu:///system start $vmname
	sleep 30
else
	notify-send "La machine virtuelle $vmname est d√©j√† en cours d'ex√©cution." "Lancement de xfreerdp maintenant !"
	echo "Lancement de xfreerdp maintenant..."
fi

if command -v xfreerdp >/dev/null 2>&1; then
	xfreerdp -grab-keyboard /v:$vmip /size:100% /cert-ignore /u:$user /p:$password /d: /dynamic-resolution /gfx-h264:avc444 +gfx-progressive /f &
elif command -v xfreerdp3 >/dev/null 2>&1; then
	xfreerdp3 -v:$vmip -u:$user -p:$password -d: -dynamic-resolution /cert:ignore /f /gfx:AVC444 &
else
	echo "'xfreerdp' ou 'xfreerdp3' commande introuvable."
fi
```

## Gestion des paquets

**Pacman** s'occupe des paquets core/extra, **yay** de ceux d'**AUR**. Une fois par mois, je nettoie les paquets orphelins et le cache :

```sh
sudo pacman -Rns $(pacman -Qtdq) && yay -Scc
```

## Configuration des snapshots automatiques

Il est conseill√© d'√©tablir un "PRA" pour le syst√®me d'exploitation lors de l'installation initiale. Les mises √† jour peuvent parfois entrer en conflit ou perturber les paquets syst√®me, entra√Ænant des probl√®mes de d√©marrage/de connexion. J'ai donc utilis√© timeshift pour cr√©er des instantan√©s quotidiens, conservant les trois derniers jours. De plus, j'ai int√©gr√© le package timeshift-autosnap AUR pour g√©n√©rer automatiquement un instantan√© de timeshift lors des mises √† jour initi√©es via les hooks pacman.

Ensuite, j'ai configur√© Grub pour rendre ces snapshots accessibles, permettant un d√©marrage direct dans ceux-ci. J'ai suivi ce [tutoriel](https://discovery.endeavouros.com/encrypted-installation/btrfs-with-timeshift-snapshots-on-the-grub-menu/2022/02/).

Menu de d√©marrage Grub | Liste des snapshots
:---: | :---:
![](../../../assets/linux/my-configuration/menu.webp) | ![](../../../assets/linux/my-configuration/snapshot.webp)